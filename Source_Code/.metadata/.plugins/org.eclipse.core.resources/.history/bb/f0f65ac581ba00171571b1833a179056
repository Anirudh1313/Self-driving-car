/*
 * obstacle_avoidance.cpp
 *
 *  Created on: Oct 25, 2017
 *      Author: Sucheta
 */

#include "obstacle_avoidance.hpp"
MOTOR_SIGNAL_t obstacle_avoidance(SENSOR_SONARS_t sensor_msg_decoded)
{
	MOTOR_SIGNAL_t obst_avoided_msg;

	/* Ranges: 	Stop range (0): < 20 inches
	 * 			FullLeft/FullRight range (1): 21 - 110 inches
	 * 			SlightLeft/SlightRiht range (2): 111 - 200 inches
	 */
	uint16_t left_range,middle_range,right_range,rear_range;

	switch (sensor_msg_decoded.SENSOR_SONARS_left) {
	        case 1: if(sensor_msg_decoded.SENSOR_SONARS_left<=20)
	        		left_range = 0; break;
	        case 2: if(sensor_msg_decoded.SENSOR_SONARS_left>20 && sensor_msg_decoded.SENSOR_SONARS_left<=110)
	        		left_range = 1; break;
	        case 3: if(sensor_msg_decoded.SENSOR_SONARS_left>110 && sensor_msg_decoded.SENSOR_SONARS_left<=200)
	        		left_range = 2; break;
	    }
	switch (sensor_msg_decoded.SENSOR_SONARS_middle) {
			case 1: if(sensor_msg_decoded.SENSOR_SONARS_middle<=20)
					middle_range = 0; break;
			case 2: if(sensor_msg_decoded.SENSOR_SONARS_middle>20 && sensor_msg_decoded.SENSOR_SONARS_middle<=110)
					middle_range = 1; break;
			case 3: if(sensor_msg_decoded.SENSOR_SONARS_middle>110 && sensor_msg_decoded.SENSOR_SONARS_middle<=200)
					middle_range = 2; break;
		}
	switch (sensor_msg_decoded.SENSOR_SONARS_right) {
			case 1: if(sensor_msg_decoded.SENSOR_SONARS_right<=20)
					right_range = 0; break;
			case 2: if(sensor_msg_decoded.SENSOR_SONARS_right>20 && sensor_msg_decoded.SENSOR_SONARS_right<=110)
					right_range = 1; break;
			case 3: if(sensor_msg_decoded.SENSOR_SONARS_right>110 && sensor_msg_decoded.SENSOR_SONARS_right<=200)
					right_range = 2; break;
		}

	//Stop 000
	if(left_range == 0  && middle_range == 0 && right_range == 0)
	{
		//Stop
		obst_avoided_msg.MOTOR_DRIVE_NEUTRAL = 1;
		obst_avoided_msg.MOTOR_STEER_ANGLE = 15.1;
	}
	//Stop - 001/100
	else if((left_range == 0  && middle_range == 0 && right_range == 1)
			|| ((left_range == 1  && middle_range == 0 && right_range == 0)))
	{
		//Stop
		obst_avoided_msg.MOTOR_DRIVE_NEUTRAL = 1;
		obst_avoided_msg.MOTOR_STEER_ANGLE = 15.1;
	}
	//Right forward -011/012/021/022
	else if(left_range == 0  && (middle_range == 1 || middle_range == 2)
			&& (right_range == 1 || right_range == 2))
	{
		obst_avoided_msg.MOTOR_STEER_FULL_RIGHT = 19.8;
		obst_avoided_msg.MOTOR_DRIVE_FORWARD = 1;
	}
	//Left forward - 110/120/210/220
	else if((left_range == 1 || left_range == 2)  && (middle_range == 1 || middle_range == 2)
			&& right_range == 0)
	{
		obst_avoided_msg.MOTOR_STEER_FULL_LEFT = 10.1;
		obst_avoided_msg.MOTOR_DRIVE_FORWARD = 1;

	}
	//Straight - 010/020
	else if(left_range == 0  && (middle_range == 1 || middle_range == 2)
				&& right_range == 0)
	{
		obst_avoided_msg.MOTOR_DRIVE_FORWARD = 1;
		obst_avoided_msg.MOTOR_DRIVE_NEUTRAL =
	}
	//Default condition - should be follow GPS, for now we have default go straight
	else
	{

	}
}
/*
BO_ 200 SENSOR_SONARS: 8 SENSOR
 SG_ SENSOR_SONARS_left : 0|16@1+ (1,0) [0|256] "" DRIVER,IO
 SG_ SENSOR_SONARS_middle : 16|16@1+ (1,0) [0|256] "" DRIVER,IO
 SG_ SENSOR_SONARS_right : 32|16@1+ (1,0) [0|256] "" DRIVER,IO
 SG_ SENSOR_SONARS_rear : 48|16@1+ (1,0) [0|256] "" DRIVER,IO
*/

